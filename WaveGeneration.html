<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>波形产生 / Wave Generation - Wuli布雷克</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFF9F0;
            --primary: #FF8c42;
            --secondary: #FFC75F;
            --accent: #FF5E5B;
            --text-dark: #4A403A;
            --card-bg: #FFFFFF;
            --shadow: 0 6px 30px rgba(255, 140, 66, 0.18);
            --radius: 30px;
            --a-color: #E67E22;
            /* Amplitude */
            --l-color: #3498db;
            /* Wavelength */
            --f-color: #2ecc71;
            /* Frequency */
            --t-color: #9b59b6;
            /* Period */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Fredoka', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 15px 40px;
        }

        .branding {
            position: fixed;
            top: 25px;
            left: 30px;
            z-index: 1000;
        }

        .logo {
            font-weight: 700;
            font-size: 1.6rem;
            color: #FFFFFF;
            background: var(--primary);
            padding: 10px 25px;
            border-radius: 20px;
            box-shadow: 4px 4px 15px rgba(255, 140, 66, 0.3);
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin-top: 15px;
            display: grid;
            grid-template-areas:
                "header header"
                "formula formula"
                "diagram controls";
            grid-template-columns: 1fr 450px;
            gap: 20px;
        }

        header {
            grid-area: header;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .subtitle-text {
            font-size: 1.25rem;
            color: #5D6D7E;
            line-height: 1.4;
        }

        /* Formula Section */
        .formula-display {
            grid-area: formula;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #fff5eb;
        }

        .formula-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            height: 90px;
            width: 100%;
        }

        .result-row {
            font-size: 1.25rem;
            font-weight: 600;
            color: #666;
            margin-top: 5px;
            display: flex;
            gap: 25px;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 25px;
            justify-content: center;
            border-top: 1px solid #f0f0f0;
            padding-top: 10px;
            width: 100%;
            flex-wrap: wrap;
        }

        .legend-item {
            font-size: 1rem;
            font-weight: 600;
        }

        .sym-key {
            font-weight: 700;
            margin-right: 5px;
        }

        /* Diagram Section */
        .diagram-section {
            grid-area: diagram;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            border: 2px solid #fff;
        }

        canvas {
            width: 100%;
            flex: 1;
            display: block;
        }

        /* Controls Section */
        .controls-section {
            grid-area: controls;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-panel {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            font-size: 1.15rem;
        }

        .val-badge {
            background: #fff;
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 1.1rem;
            border: 2px solid #f0f0f0;
        }

        input[type=range] {
            width: 100%;
            appearance: none;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            background: var(--primary);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        #amp-slider::-webkit-slider-thumb {
            background: var(--a-color);
        }

        #len-slider::-webkit-slider-thumb {
            background: var(--l-color);
        }

        #freq-slider::-webkit-slider-thumb {
            background: var(--f-color);
        }

        select {
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid #eee;
            font-family: inherit;
            font-size: 1.1rem;
            outline: none;
            cursor: pointer;
            color: var(--text-dark);
            font-weight: 600;
            transition: all 0.2s;
        }

        select:hover {
            border-color: var(--primary);
        }

        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .ctrl-btn {
            padding: 14px;
            border: none;
            border-radius: 18px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .start {
            background-color: var(--primary);
        }

        .pause {
            background-color: #2ecc71;
        }

        .reset {
            background-color: #95a5a6;
        }

        .ctrl-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Mode Specific Visibility */
        .mode-dist {
            display: none;
        }

        .mode-time {
            display: none;
        }

        @media (max-width: 1100px) {
            .container {
                grid-template-areas: "header" "formula" "diagram" "controls";
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="branding">
        <div class="logo">Wuli布雷克</div>
    </div>

    <div class="container">
        <header>
            <h1>波形产生 / Wave Generation</h1>
        </header>

        <!-- Formula Section -->
        <section class="formula-display">
            <div class="formula-container" id="formula-root">
                <!-- Dynamic Formula -->
            </div>
            <div class="result-row" style="font-family: inherit;">
                <span id="res-val-1"></span>
                <span id="res-val-2"></span>
            </div>
            <div class="legend">
                <div class="legend-item"><span class="sym-key" style="color:var(--a-color)">A</span>: Amplitude (振幅)
                </div>
                <div class="legend-item" id="leg-l"><span class="sym-key" style="color:var(--l-color)">λ</span>:
                    Wavelength (波长)</div>
                <div class="legend-item" id="leg-f"><span class="sym-key" style="color:var(--f-color)">f</span>:
                    Frequency (频率)</div>
                <div class="legend-item" id="leg-t"><span class="sym-key" style="color:var(--t-color)">T</span>: Period
                    (周期)</div>
            </div>
        </section>

        <!-- Diagram Section -->
        <section class="diagram-section">
            <canvas id="simCanvas"></canvas>
        </section>

        <!-- Controls Section -->
        <section class="controls-section">
            <div class="control-panel">
                <div class="control-group">
                    <div class="label-row"><span>Domain Mode (坐标维度)</span></div>
                    <select id="domain-select">
                        <option value="distance">Distance 距离 (y - x)</option>
                        <option value="time">Time 时间 (y - t)</option>
                    </select>
                </div>

                <div class="control-group">
                    <div class="label-row">
                        <span>Amplitude (振幅 A)</span>
                        <span id="amp-badge" class="val-badge">2.5 cm</span>
                    </div>
                    <input type="range" id="amp-slider" min="0.5" max="6.0" step="0.1" value="2.5">
                </div>

                <!-- Distance Mode Controls -->
                <div class="control-group mode-dist">
                    <div class="label-row">
                        <span>Wavelength (波长 λ)</span>
                        <span id="len-badge" class="val-badge">10 cm</span>
                    </div>
                    <input type="range" id="len-slider" min="5" max="30" step="0.5" value="10">
                </div>

                <!-- Time Mode Controls -->
                <div class="control-group mode-time">
                    <div class="label-row">
                        <span>Frequency (频率 f)</span>
                        <span id="freq-badge" class="val-badge">1.0 Hz</span>
                    </div>
                    <input type="range" id="freq-slider" min="0.1" max="5.0" step="0.1" value="1.0">
                </div>

                <div class="btn-row">
                    <button id="btn-start" class="ctrl-btn start">开始 Start</button>
                    <button id="btn-reset" class="ctrl-btn reset">重置 Reset</button>
                </div>
            </div>

            <div class="info-card"
                style="background: var(--card-bg); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow);">
                <div style="font-weight: 700; color: var(--primary); margin-bottom: 12px; font-size: 1.25rem;">演示要点 /
                    Key points</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div
                        style="background: white; padding: 12px; border: 1px solid #eee; border-radius: 15px; display: grid; grid-template-columns: 45px 1fr; gap: 10px; align-items: center;">
                        <div
                            style="width: 40px; height: 40px; background: rgba(52, 172, 224, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--l-color); font-weight: 700; font-size: 1.2rem;">
                            x</div>
                        <div>
                            <div style="font-weight: 700; font-size: 1rem;">距离图 (Distance Graph)</div>
                            <div style="font-size: 0.85rem; color: #888;">展现波在某一时刻的空间全貌 / Spatial snapshot</div>
                        </div>
                    </div>
                    <div
                        style="background: white; padding: 12px; border: 1px solid #eee; border-radius: 15px; display: grid; grid-template-columns: 45px 1fr; gap: 10px; align-items: center;">
                        <div
                            style="width: 40px; height: 40px; background: rgba(155, 89, 182, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--t-color); font-weight: 700; font-size: 1.2rem;">
                            t</div>
                        <div>
                            <div style="font-weight: 700; font-size: 1rem;">时间图 (Time Graph)</div>
                            <div style="font-size: 0.85rem; color: #888;">展现质点随时间振动的历程 / Displacement history</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas'), ctx = canvas.getContext('2d');
        const sDomain = document.getElementById('domain-select');
        const sAmp = document.getElementById('amp-slider'), sLen = document.getElementById('len-slider'), sFreq = document.getElementById('freq-slider');
        const bAmp = document.getElementById('amp-badge'), bLen = document.getElementById('len-badge'), bFreq = document.getElementById('freq-badge');
        const resV1 = document.getElementById('res-val-1'), resV2 = document.getElementById('res-val-2');
        const legL = document.getElementById('leg-l'), legF = document.getElementById('leg-f'), legT = document.getElementById('leg-t');
        const bStart = document.getElementById('btn-start'), bReset = document.getElementById('btn-reset');
        const fRoot = document.getElementById('formula-root');

        const state = {
            domain: 'distance', // 'distance' or 'time'
            amp: 2.5, wavelength: 10, freq: 1.0,
            time: 0, isPlaying: false, // Default paused
            pxPerCm: 20,
            v: 150 // Pixel speed (approx 7.5 cm/s)
        };

        function resize() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        window.addEventListener('resize', resize);

        function update() {
            state.domain = sDomain.value;
            state.amp = parseFloat(sAmp.value);
            state.wavelength = parseFloat(sLen.value);
            state.freq = parseFloat(sFreq.value);

            // Update UI visibility
            document.querySelectorAll('.mode-dist').forEach(el => el.style.display = state.domain === 'distance' ? 'flex' : 'none');
            document.querySelectorAll('.mode-time').forEach(el => el.style.display = state.domain === 'time' ? 'flex' : 'none');
            legL.style.display = state.domain === 'distance' ? 'block' : 'none';
            legF.style.display = state.domain === 'time' ? 'block' : 'none';
            legT.style.display = state.domain === 'time' ? 'block' : 'none';

            bAmp.textContent = state.amp + ' cm';
            bLen.textContent = state.wavelength + ' cm';
            bFreq.textContent = state.freq.toFixed(1) + ' Hz';

            if (state.isPlaying) {
                state.time += 0.016;
            }

            updateUI();
            draw();
            requestAnimationFrame(update);
        }

        function updateUI() {
            const baseSize = 35;
            if (state.domain === 'distance') {
                fRoot.innerHTML = `
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:${baseSize}px">y = </span>
                        <span style="color:var(--a-color); font-size:${baseSize * 0.9}px; font-weight:700;">${state.amp}</span>
                        <span style="font-size:${baseSize}px">sin(</span>
                        <div style="display:flex; flex-direction:column; align-items:center; margin-top:10px;">
                            <span style="font-size:${baseSize * 0.6}px; border-bottom:2px solid; padding:0 5px;">2πx</span>
                            <span style="color:var(--l-color); font-size:${baseSize * 0.6}px; font-weight:700;">${state.wavelength}</span>
                        </div>
                        <span style="font-size:${baseSize}px">)</span>
                    </div>
                `;
                resV1.innerHTML = `振幅 <span style="color:var(--a-color)">A = ${state.amp} cm</span>`;
                resV2.innerHTML = `波长 <span style="color:var(--l-color)">λ = ${state.wavelength} cm</span>`;
            } else {
                const sF = 1 + (state.freq / 5.0) * 0.4;
                const period = (1 / state.freq).toFixed(2);
                fRoot.innerHTML = `
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:${baseSize}px">y = </span>
                        <span style="color:var(--a-color); font-size:${baseSize * 0.9}px; font-weight:700;">${state.amp}</span>
                        <span style="font-size:${baseSize}px">sin(2π · </span>
                        <span style="color:var(--f-color); font-size:${baseSize * 0.9}px; font-weight:700;">${state.freq.toFixed(1)}</span>
                        <span style="font-size:${baseSize}px">t)</span>
                    </div>
                `;
                resV1.innerHTML = `频率 <span style="color:var(--f-color)">f = ${state.freq.toFixed(1)}</span> Hz`;
                resV2.innerHTML = `周期 <span style="color:var(--t-color)">T = ${period}</span> s`;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const midY = canvas.height / 2;
            const midX = canvas.width / 2;

            // Draw Grid
            ctx.strokeStyle = '#e0f0f0'; ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }

            // Draw Axes
            ctx.strokeStyle = '#95a5a6'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(50, midY); ctx.lineTo(canvas.width - 50, midY); ctx.stroke(); // X
            ctx.beginPath(); ctx.moveTo(50, 50); ctx.lineTo(50, canvas.height - 50); ctx.stroke(); // Y

            // Ticks & Values
            ctx.fillStyle = '#95a5a6'; ctx.font = '500 12px Fredoka';
            ctx.textAlign = 'center';
            // X-Ticks
            for (let i = 0; i <= 25; i++) {
                const x = 50 + i * state.pxPerCm * 2;
                if (x > canvas.width - 50) break;
                ctx.beginPath(); ctx.moveTo(x, midY - 5); ctx.lineTo(x, midY + 5); ctx.stroke();
                ctx.fillText(i * 2, x, midY + 20);
            }
            // Y-Ticks
            ctx.textAlign = 'right';
            for (let i = -6; i <= 6; i += 2) {
                if (i === 0) continue;
                const y = midY - i * state.pxPerCm;
                ctx.beginPath(); ctx.moveTo(45, y); ctx.lineTo(55, y); ctx.stroke();
                ctx.fillText(i, 40, y + 4);
            }

            // Labels
            ctx.fillStyle = '#95a5a6'; ctx.font = '700 18px Fredoka';
            ctx.fillText('y (cm)', 75, 40);
            const xLabel = state.domain === 'distance' ? 'x (Distance 距离/cm)' : 't (Time 时间/s)';
            ctx.textAlign = 'right';
            ctx.fillText(xLabel, canvas.width - 60, midY + 45);

            // Draw Wave as connected balls
            const points = 100;
            const step = (canvas.width - 100) / points;

            ctx.beginPath();
            ctx.strokeStyle = varColor('--primary') + '44';
            ctx.lineWidth = 2;

            for (let i = 0; i <= points; i++) {
                const x = 50 + i * step;
                let y;

                if (state.domain === 'distance') {
                    // y = A * sin(2pi * (ft - x/L)) if t >= x/v else 0
                    const pxX = i * step;
                    const cmX = pxX / state.pxPerCm;
                    const cmL = state.wavelength;
                    const freq = state.freq;
                    const cmV = state.v / state.pxPerCm;

                    const timeNeeded = pxX / state.v;
                    if (state.time >= timeNeeded) {
                        y = midY - state.amp * state.pxPerCm * Math.sin(2 * Math.PI * (state.freq * state.time - pxX / (state.wavelength * state.pxPerCm)));
                    } else {
                        y = midY;
                    }
                } else {
                    // y-t graph for the element at x=0
                    // or history of the source
                    const t = (i / points) * 5;
                    if (state.time >= t) {
                        y = midY - state.amp * state.pxPerCm * Math.sin(2 * Math.PI * state.freq * (state.time - t));
                    } else {
                        y = midY;
                    }
                }

                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Draw the "Small Balls"
            const ballInterval = 4; // Draw every Nth point
            for (let i = 0; i <= points; i += ballInterval) {
                const x = 50 + i * step;
                let y;
                const pxX = i * step;
                if (state.domain === 'distance') {
                    const timeNeeded = pxX / state.v;
                    if (state.time >= timeNeeded) {
                        y = midY - state.amp * state.pxPerCm * Math.sin(2 * Math.PI * (state.freq * state.time - pxX / (state.wavelength * state.pxPerCm)));
                    } else {
                        y = midY;
                    }
                } else {
                    const t = (i / points) * 5;
                    if (state.time >= t) {
                        y = midY - state.amp * state.pxPerCm * Math.sin(2 * Math.PI * state.freq * (state.time - t));
                    } else {
                        y = midY;
                    }
                }

                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fillStyle = (i % (ballInterval * 5) === 0) ? varColor('--accent') : varColor('--secondary');
                ctx.fill();
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 1; ctx.stroke();
            }

            // Highlight one particle in distance mode to show simple harmonic motion
            if (state.domain === 'distance') {
                const idx = 25;
                const pxX = idx * step;
                const hX = 50 + pxX;
                const timeNeeded = pxX / state.v;
                let hY = midY;
                if (state.time >= timeNeeded) {
                    hY = midY - state.amp * state.pxPerCm * Math.sin(2 * Math.PI * (state.freq * state.time - pxX / (state.wavelength * state.pxPerCm)));
                }

                ctx.beginPath();
                ctx.arc(hX, hY, 10, 0, Math.PI * 2);
                ctx.strokeStyle = 'var(--accent)'; ctx.lineWidth = 4; ctx.stroke();
                ctx.fillStyle = 'rgba(255,140,66,0.2)'; ctx.fill();

                ctx.fillStyle = 'var(--accent)'; ctx.font = '600 14px Noto Sans SC';
                ctx.textAlign = 'center';
                ctx.fillText('质点 P', hX, hY - 20);
            }
        }

        function varColor(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        bStart.onclick = () => {
            state.isPlaying = !state.isPlaying;
            bStart.textContent = state.isPlaying ? '暂停 Pause' : '开始 Start';
            bStart.classList.toggle('start', !state.isPlaying);
            bStart.classList.toggle('pause', state.isPlaying);
        };

        bReset.onclick = () => {
            state.time = 0;
            state.isPlaying = false;
            bStart.textContent = '开始 Start';
            bStart.className = 'ctrl-btn start';
        };

        resize();
        update();
    </script>
</body>

</html>